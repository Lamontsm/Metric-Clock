<!doctype html>
<html>

<head>
    <title>Metric Clock</title>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

    <style type="text/css">
        #toMetric {
            display: none
        };
        #showTimes {
            display: none
        };

    </style>
</head>

<body>

    <script>
        const OFFSET = 3;  // arbitrary for now
        startTime();

        function startTime() {

            // //Calculate current Metric time
            let curTime = new Date();
            let timeZone = curTime.getTimezoneOffset() / (-60);        //PT is -8           
            curTime.setHours(curTime.getHours() - OFFSET - timeZone);
            let mt = convertTime(curTime);

            $("#sendTime").text(mt.mhrs + ":" + mt.mmins.toString().padStart(2, '0') + ":" + mt.msecs.toString().padStart(3, '0'));
            $("#sendDate").text(mt.day + " " + mt.date + " " + mt.month + " " + mt.year);
            var t = setTimeout(startTime, 864); // Note set for metric seconds
        }

        // Uncover the converter dialogue
        $(document).ready(function () {
            $("#convertTo").click(function () {
                $("#toMetric").show();
            });
        });

        // Convert input time to metric  
        time = new Date();  // For plugging in the defaults
        let nYear = 2022;  //time.getFullYear();
        let nMonth = 0;   //time.getMonth();
        let nDate = 22;    //time.getDate(); not zero-based
        let nTimeZone = -8;  //time.getTimeZoneOffset()/60
        let dayLightSav = 0; //Standard time = 0, daylight saving = -1
        let nHours = 22;   //time.getHours() + OFFSET + nTimeZone;
        let nMins = 0;    //time.getMinutes();
        let nSecs = 0;    //time.getSeconds();
        newTime = new Date(nYear, nMonth, nDate, nHours - OFFSET - nTimeZone + dayLightSav, nMins, nSecs);
        let nt = convertTime(newTime);


        $(document).ready(function () {
            $("#Submit").click(function () {
                console.log("\nMetric time after conversion");
                console.log(nt.mhrs + ":" + nt.mmins.toString().padStart(2, '0') + ":" + nt.msecs.toString().padStart(3, '0'))
                console.log(nt.day + ' ' + nt.date + ' ' + nt.month + ' ' + nt.year);
                $("#convTime").text(nt.mhrs + ":" + nt.mmins.toString().padStart(2, '0') + ":" + nt.msecs.toString().padStart(3, '0'));
                $("#convDate").text(nt.day + " " + nt.date + " " + nt.month + " " + nt.year);
            });
        });


        function convertTime(time) {
            let t = {};
            t.year = time.getFullYear();
            t.month = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"][time.getMonth()];
            t.date = time.getDate();
            t.day = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"][time.getDay()];
            let remain = ((time.getHours() * 60) + time.getMinutes()) * 60 + time.getSeconds();

            remain = remain * 1000000 / 86400;
            t.mhrs = Math.floor(remain / 100000);
            remain -= t.mhrs * 100000;
            t.mmins = Math.floor(remain / 1000);
            remain -= t.mmins * 1000;
            t.msecs = Math.floor(remain);
            return t;
        }

    </script>

    <h1>Current Metric Time</h1>
    <h1 id="sendTime"></h1>
    <h1 id="sendDate"></h1>
    <br>

    <button type="button" id="convertTo" class="btn btn-primary hitme hideme">Convert to Metric Time</button>
    <div id="toMetric">
        <!-- TODO: Get input from dropdown menu -->
        <p>Time Zone: <input type="text" id="timeZone" value="Pacific"></p>

        <!-- TODO Print Results -->
        <button id="Submit">Submit</button>
        <div id="showTimes">
            <!-- Problem: not hiding -->
            <h2>Converted Metric Time</h2>   
            <p id="convTime">time shows here</p>
            <p id="convDate">date shows here</p>
        </div>

    </div>

    <!-- Example split danger button -->
    <!-- <div class="btn-group">
        <button type="button" class="btn btn-danger">Action</button>
        <button type="button" class="btn btn-danger dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
        <span class="visually-hidden">Toggle Dropdown</span>
        </button>

        <ul class="dropdown-menu">
        <li><a class="dropdown-item" href="#">Action</a></li>
        <li><a class="dropdown-item" href="#">Another action</a></li>
        <li><a class="dropdown-item" href="#">Something else here</a></li>
        <li><hr class="dropdown-divider"></li>
        <li><a class="dropdown-item" href="#">Separated link</a></li>
        </ul>
    </div> -->

</body>

</html>