<!doctype html>
<html>

<head>
    <title>Metric Clock</title>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- Bootstrap CSS -->
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous"> -->

    <style type="text/css">

    </style>
</head>

<body>
    <h1>Current Metric Time</h1>
    <h1 id="sendTime"></h1>
    <h1 id="sendDate"></h1>
    <br>

    <button type="button" id="convertTo" class="btn btn-primary hitme hideme">Convert to Metric Time</button>
    <div id="toMetric">

        <label for="newtime">Date and time to convert from </label>
        <br>
        <input type="datetime-local" id="newtime" name="newtime" value="">
        <br>

        <label for="timezone">Choose a timezone:</label>
        <br>
        <select name="timezone" id="timezone">
            <option value='0'> GMT Greenwich Mean Time GMT </option>
            <option value='0'> UTC Universal Coordinated Time GMT </option>
            <option value='1'> ECT European Central Time GMT+1:00 </option>
            <option value='2'> EET Eastern European Time GMT+2:00 </option>
            <option value='2'> ART (Arabic) Egypt Standard Time GMT+2:00 </option>
            <option value='3'> EAT Eastern African Time GMT+3:00 </option>
            <option value='3.5'> MET Middle East Time GMT+3:30 </option>
            <option value='4'> NET Near East Time GMT+4:00 </option>
            <option value='5'> PLT Pakistan Lahore Time GMT+5:00 </option>
            <option value='5.5'> IST India Standard Time GMT+5:30 </option>
            <option value='6'> BST Bangladesh Standard Time GMT+6:00 </option>
            <option value='7'> VST Vietnam Standard Time GMT+7:00 </option>
            <option value='8'> CTT China Taiwan Time GMT+8:00 </option>
            <option value='9'> JST Japan Standard Time GMT+9:00 </option>
            <option value='9.5'> ACT Australia Central Time GMT+9:30 </option>
            <option value='10'> AET Australia Eastern Time GMT+10:00 </option>
            <option value='11'> SST Solomon Standard Time GMT+11:00 </option>
            <option value='12'> NST New Zealand Standard Time GMT+12:00 </option>
            <option value='-11'> MIT Midway Islands Time GMT-11:00 </option>
            <option value='-10'> HST Hawaii Standard Time GMT-10:00 </option>
            <option value='-9'> AST Alaska Standard Time GMT-9:00 </option>
            <option value='-8'> PST Pacific Standard Time GMT-8:00 </option>
            <option value='-7'> PNT Phoenix Standard Time GMT-7:00 </option>
            <option value='-7'> MST Mountain Standard Time GMT-7:00 </option>
            <option value='-6'> CST Central Standard Time GMT-6:00 </option>
            <option value='-5'> EST Eastern Standard Time GMT-5:00 </option>
            <option value='-5'> IET Indiana Eastern Standard Time GMT-5:00 </option>
            <option value='-4'> PRT Puerto Rico and US Virgin Islands Time GMT-4:00 </option>
            <option value='-3.5'> CNT Canada Newfoundland Time GMT-3:30 </option>
            <option value='-3'> AGT Argentina Standard Time GMT-3:00 </option>
            <option value='-3'> BET Brazil Eastern Time GMT-3:00 </option>
            <option value='-1'> CAT Central African Time GMT-1:00 </option>
        </select>
        <br>
        <label>Note whether daylight savings (summer) or not</label><br>
        Regular Time<input type="radio" name='timeShift' id="timeShift" value="0">
        Daylight Savings<input type="radio" name='timeShift' id="timeShift" value="-1"><br>
        <input id="choosetime" type="submit" value="Submit">



        <!-- <p>Year: <input type="number" id="year" name="year" value=""></p>
        <label for="month">Month: </label>
        <select name="month" id="month">
            <option value="0">January</option>
            <option value="1">February</option>
            <option value="2">March</option>
            <option value="3">April</option>
            <option value="4">May</option>
            <option value="5">June</option>
            <option value="6">July</option>
            <option value="7">August</option>
            <option value="8">September</option>
            <option value="9">October</option>
            <option value="10">November</option>
            <option value="11">December</option>
        </select> -->
        <!-- <p>Date: <input type="number" id="date" name="date" value=""></p>
        <p>Time Zone: <input type="text" id="timeZone" value="Pacific"></p> -->

        <!-- retrieve date and time with HTML input https://www.w3schools.com/html/tryit.asp?filename=tryhtml_input_datetime-local-->

        <!-- Print Results -->
        <!-- <button id="revealTime">Submit</button> -->
        <div id="showTimes">
            <h2>Converted Metric Time</h2>
            <p id="convTime">time shows here</p>
            <p id="convDate">date shows here</p>
        </div>

    </div>
    <script>
        const OFFSET = 3;  // arbitrary for now
        $("#toMetric").hide();  // these don't seem to be working
        $("#showTimes").hide();

        startTime();

        // Uncover the converter dialogue
        $(document).ready(function () {
            $("#convertTo").click(function () {
                $("#toMetric").show();
                let newTime;

                // Get inputs of time to convert
                $(document).ready(function () {
                    $("#choosetime").click(function () {
                        // inputs of time
                        newTime = $("#newtime").val();

                        // Parse time from returned field  2022-02-10T17:30
                        let nYear = newTime.slice(0, 4);
                        let nMonth = newTime.slice(5, 7) - 1;
                        let nDate = newTime.slice(8, 10); //not zero-based
                        let nHours = newTime.slice(11, 13);   //time.getHours() + OFFSET + nTimeZone;
                        let nMins = newTime.slice(14, 16);    //time.getMinutes();
                        let nTimeZone = $('#timezone').val();  //time.getTimeZoneOffset()/60
                        let dayLightSav = $("input[name='timeShift']:checked").val();
                // *
                // Need to fix the nHours calculation. Multiplying by 100 somewhere?
                // *
                        console.log('Hours before: ' + nHours);
                        console.log('nTimeZone: ' + nTimeZone + ' Offset: ' + OFFSET + ' dls: ' + dayLightSav);
                        nHours = nHours + nTimeZone + dayLightSav - OFFSET;
                        console.log('Hours after: ' + nHours);
                        console.log(nYear + ' ' + nMonth + ' ' + nDate + ' ' + nHours + ' ' + nMins);
                        // Calculate new time
                        // newTime = new Date(nYear, nMonth, nDate, nHours - OFFSET - nTimeZone + dayLightSav, nMins, nSecs);
                        // let nt = convertTime(time); // will need to change to newTime

                        // show converted time
                        $("#showTimes").show();
                        $('#convTime').text('this is the converted time');  // Remove this later
                        // $("#convTime").text(nt.mhrs + ":" + nt.mmins.toString().padStart(2, '0') + ":" + nt.msecs.toString().padStart(3, '0'));
                        // $("#convDate").text(nt.day + " " + nt.date + " " + nt.month + " " + nt.year);

                    });
                });
            });
        });

        // Convert input time to metric  
        // Don't need this with the date-time function
        // time = new Date();  // For plugging in the defaults
        // let nYear = time.getFullYear();
        // let nMonth = time.getMonth();
        // let nDate = time.getDate(); //not zero-based
        // let nTimeZone = -8;  //time.getTimeZoneOffset()/60
        // let dayLightSav = 0; //Standard time = 0, daylight saving = -1
        // let nHours = 22;   //time.getHours() + OFFSET + nTimeZone;
        // let nMins = 0;    //time.getMinutes();
        // let nSecs = 0;    //time.getSeconds();
        // let newTime;

        // Get inputs of time to convert
        // $(document).ready(function () {
        //     $("#choosetime").click(function () {
        //         // inputs of time
        //         newTime = $("#newtime").val();
        //         console.log("Text: " + newTime);
        //     });
        // });

        // $(document).ready(function () {
        //     $('#year').val(nYear);
        //     $('#month').val(nMonth);
        //     $('#date').val(nDate);

        //     $("#Submit").click(function () {
        //         nYear = $("#year").val();
        //         nMonth = $("#month").val();
        //         nDate = $("#date").val();
        //         alert("Date is " + nDate);
        //     });

        // TODO: Now do the other inputs
        // });

        // Calculate new time
        // newTime = new Date(nYear, nMonth, nDate, nHours - OFFSET - nTimeZone + dayLightSav, nMins, nSecs);
        // let nt = convertTime(time); // will need to change to newTime
        // Output converted metric time
        // $(document).ready(function () {
        //     $("#choosetime").click(function () {
        //         // show converted time
        //         $("#showTimes").show();
        //         $("#convTime").text(nt.mhrs + ":" + nt.mmins.toString().padStart(2, '0') + ":" + nt.msecs.toString().padStart(3, '0'));
        //         $("#convDate").text(nt.day + " " + nt.date + " " + nt.month + " " + nt.year);
        //     });
        // });

        function startTime() {

            // //Calculate current Metric time
            let curTime = new Date();
            let timeZone = curTime.getTimezoneOffset() / (-60);        //PT is -8           
            curTime.setHours(curTime.getHours() - OFFSET - timeZone);
            let mt = convertTime(curTime);

            $("#sendTime").text(mt.mhrs + ":" + mt.mmins.toString().padStart(2, '0') + ":" + mt.msecs.toString().padStart(3, '0'));
            $("#sendDate").text(mt.day + " " + mt.date + " " + mt.month + " " + mt.year);
            var t = setTimeout(startTime, 864); // Note set for metric seconds
        }

        function convertTime(time) {
            let t = {};
            t.year = time.getFullYear();
            t.month = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"][time.getMonth()];
            t.date = time.getDate();
            t.day = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"][time.getDay()];
            let remain = ((time.getHours() * 60) + time.getMinutes()) * 60 + time.getSeconds();
            remain = remain * 1000000 / 86400;
            t.mhrs = Math.floor(remain / 100000);
            remain -= t.mhrs * 100000;
            t.mmins = Math.floor(remain / 1000);
            remain -= t.mmins * 1000;
            t.msecs = Math.floor(remain);
            return t;
        }

    </script>



</body>

</html>